<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±Ÿè‹æµ·ç››æ±½è½¦é›¶éƒ¨ä»¶ç§‘æŠ€æœ‰é™å…¬å¸é€æ£€çœ‹æ¿</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chart.js Annotation Plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/1.4.0/chartjs-plugin-annotation.min.js"></script>
    <!-- SortableJS for drag and drop -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        /* Custom styling based on machine.html */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Microsoft YaHei', sans-serif;
            color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #dashboard-container {
            width: 100vw;
            height: calc(100vw * 9 / 16);
            max-height: 100vh;
            max-width: calc(100vh * 16 / 9);
            margin: auto;
            display: flex;
            flex-direction: column;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .card {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(15px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 1rem;
        }
        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffffff;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4ade80;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .metric-label {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.8);
            margin-top: 0.5rem;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-normal { background-color: #4ade80; }
        .status-warning { background-color: #fbbf24; }
        .status-critical { background-color: #ef4444; }
        
        /* Responsive grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 1.5rem;
            height: 100%;
        }
        
        /* Chart containers */
        .chart-container {
            position: relative;
            height: 200px;
        }
        .doughnut-container {
            position: relative;
            height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Scrolling animation for work orders */
        @keyframes scroll {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100%); }
        }
        .animate-scroll {
            animation: scroll 15s linear infinite;
        }
        .animate-scroll:hover {
            animation-play-state: paused;
        }
        .animate-scroll-slow {
            animation: scroll 30s linear infinite;
        }
        .animate-scroll-slow:hover {
            animation-play-state: paused;
        }
    </style>
</head>
<body>
    <div id="dashboard-container" class="p-6">
        <!-- Header -->
        <header class="flex items-center justify-between pb-6 mb-6 border-b border-white/20">
            <div class="flex items-center">
                <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center mr-4">
                    <svg width="24" height="24" fill="white" viewBox="0 0 24 24">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-white">æ±Ÿè‹æµ·ç››æ±½è½¦é›¶éƒ¨ä»¶ç§‘æŠ€æœ‰é™å…¬å¸</h1>
                    <p class="text-lg text-blue-200">é€æ£€çœ‹æ¿</p>
                </div>
            </div>
            <div class="text-right">
                <div class="text-sm text-blue-200">å®æ—¶æ›´æ–°</div>
                <div class="text-lg font-semibold" id="current-time"></div>
                <!-- è¶…æ—¶é¢„è­¦ç³»ç»Ÿ -->
                <div id="warning-container" class="mt-2 space-y-1">
                    <div id="overdue-warning" class="px-3 py-1 bg-yellow-500/80 rounded-lg text-sm font-semibold animate-pulse hidden">
                        âš ï¸ é¢„è­¦ä¿¡æ¯
                    </div>
                    <div id="overdue-alert" class="px-3 py-1 bg-red-500/80 rounded-lg text-sm font-semibold animate-pulse hidden">
                        ğŸš¨ ä¸¥é‡è¶…æ—¶
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Dashboard Grid -->
        <main class="dashboard-grid flex-grow">
            <!-- Card 1: åŸææ–™åˆæ ¼ç‡ç»Ÿè®¡ & Top 5ä¸è‰¯åŸå›  -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">åŸææ–™åˆæ ¼ç‡ç»Ÿè®¡ï¼ˆæœˆï¼‰</h3>
                    <span class="text-sm text-green-400" id="material-pass-rate">97.8%</span>
                </div>
                <div class="flex h-full">
                    <!-- é¥¼å›¾éƒ¨åˆ† -->
                    <div class="flex-1 relative">
                        <div class="doughnut-container">
                            <canvas id="materialQualityChart"></canvas>
                            <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                                <div class="text-xl font-bold text-white">132</div>
                                <div class="text-xs text-gray-300">æ£€éªŒæ‰¹æ¬¡</div>
                                <div class="text-xs text-green-400 mt-1">97.8% åˆæ ¼</div>
                            </div>
                        </div>
                    </div>
                    <!-- Top 5 ä¸è‰¯åŸå›  -->
                    <div class="flex-1 ml-4">
                        <h5 class="text-sm font-semibold text-red-300 mb-2 flex items-center">
                            <div class="w-3 h-3 bg-red-500 rounded mr-2"></div>
                            ä¸»è¦ä¸è‰¯åŸå›  Top 5
                        </h5>
                        <div class="space-y-2 text-xs" id="defect-reasons">
                            <div class="flex justify-between items-center py-1 px-2 bg-red-500/20 rounded border-l-4 border-red-500">
                                <span class="text-red-200">å°ºå¯¸åå·®</span>
                                <span class="text-red-400 font-bold">45%</span>
                            </div>
                            <div class="flex justify-between items-center py-1 px-2 bg-red-500/15 rounded border-l-4 border-red-400">
                                <span class="text-red-200">è¡¨é¢ç¼ºé™·</span>
                                <span class="text-red-400 font-bold">28%</span>
                            </div>
                            <div class="flex justify-between items-center py-1 px-2 bg-red-500/10 rounded border-l-4 border-red-300">
                                <span class="text-red-200">æè´¨ä¸ç¬¦</span>
                                <span class="text-red-400 font-bold">15%</span>
                            </div>
                            <div class="flex justify-between items-center py-1 px-2 bg-red-500/8 rounded border-l-4 border-red-200">
                                <span class="text-red-200">åŒ…è£…æŸå</span>
                                <span class="text-red-400 font-bold">8%</span>
                            </div>
                            <div class="flex justify-between items-center py-1 px-2 bg-red-500/5 rounded border-l-4 border-red-100">
                                <span class="text-red-200">æ ‡è¯†é”™è¯¯</span>
                                <span class="text-red-400 font-bold">4%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card 2: è¿‡ç¨‹æ£€éªŒåˆæ ¼ç‡æœˆè¶‹åŠ¿å›¾ -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">è¿‡ç¨‹æ£€éªŒåˆæ ¼ç‡æœˆè¶‹åŠ¿</h3>
                    <span class="text-sm text-green-400">å¹³å‡99.2%</span>
                </div>
                <div class="chart-container">
                    <canvas id="processTrendChart"></canvas>
                </div>
            </div>

            <!-- Card 3: åŸææ–™æ£€éªŒåˆæ ¼ç‡æœˆè¶‹åŠ¿å›¾ -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">åŸææ–™æ£€éªŒåˆæ ¼ç‡æœˆè¶‹åŠ¿</h3>
                    <span class="text-sm text-green-400">å¹³å‡97.5%</span>
                </div>
                <div class="chart-container">
                    <canvas id="materialTrendChart"></canvas>
                </div>
            </div>

            <!-- Card 4: ä»Šæ—¥é€æ£€æ•°é‡ & æ£€éªŒåŠæ—¶ç‡ -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">ä»Šæ—¥é€æ£€æ•°é‡ & æ£€éªŒåŠæ—¶ç‡</h3>
                    <span class="status-indicator status-normal"></span>
                </div>
                <div class="flex h-full">
                    <!-- é€æ£€æ•°é‡éƒ¨åˆ† -->
                    <div class="flex-1">
                        <div class="text-center mb-4">
                            <div class="metric-value text-blue-300">98</div>
                            <div class="metric-label">ä»Šæ—¥æ£€éªŒé‡</div>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-xs">
                            <div class="text-center p-2 bg-green-500/20 rounded">
                                <div class="text-lg font-bold text-green-400" id="on-time-count">93</div>
                                <div class="text-gray-300">æŒ‰æ—¶å®Œæˆ</div>
                            </div>
                            <div class="text-center p-2 bg-blue-500/20 rounded">
                                <div class="text-lg font-bold text-blue-400" id="in-progress-count">2</div>
                                <div class="text-gray-300">è¿›è¡Œä¸­</div>
                            </div>
                            <div class="text-center p-2 bg-yellow-500/20 rounded">
                                <div class="text-lg font-bold text-yellow-400" id="warning-count">2</div>
                                <div class="text-gray-300">é¢„è­¦</div>
                            </div>
                            <div class="text-center p-2 bg-red-500/20 rounded">
                                <div class="text-lg font-bold text-red-400" id="alert-count">1</div>
                                <div class="text-gray-300">ä¸¥é‡è¶…æ—¶</div>
                            </div>
                        </div>
                    </div>
                    <!-- åŠæ—¶ç‡éƒ¨åˆ† -->
                    <div class="flex-1 ml-4 flex flex-col items-center justify-center">
                        <div class="relative w-24 h-24 mb-3">
                            <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                                <path class="text-gray-700" stroke="currentColor" stroke-width="3" fill="none" 
                                    d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                <path class="text-green-400" stroke="currentColor" stroke-width="3" fill="none" 
                                    stroke-dasharray="96.8, 100" stroke-linecap="round"
                                    d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                            </svg>
                            <div class="absolute inset-0 flex flex-col items-center justify-center">
                                <div class="text-lg font-bold text-green-400">96.8%</div>
                                <div class="text-xs text-gray-300">åŠæ—¶ç‡</div>
                            </div>
                        </div>
                        <div class="text-center w-full">
                            <div class="text-xs text-gray-300 mb-1">ç›®æ ‡: 95%</div>
                            <div class="w-full bg-gray-700 rounded-full h-1.5">
                                <div class="bg-green-500 h-1.5 rounded-full" style="width: 96.8%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card 5: åŸææ–™é€æ£€å®Œæˆæƒ…å†µï¼ˆæœˆï¼‰ -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">åŸææ–™é€æ£€å®Œæˆæƒ…å†µï¼ˆæœˆï¼‰</h3>
                    <span class="text-sm text-blue-200">æœ¬æœˆè¶‹åŠ¿</span>
                </div>
                <div class="chart-container">
                    <canvas id="materialInspectionChart"></canvas>
                </div>
            </div>

            <!-- Card 6: è¿‡ç¨‹ä»¶é€æ£€å®Œæˆæƒ…å†µï¼ˆæœˆï¼‰ -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">è¿‡ç¨‹ä»¶é€æ£€å®Œæˆæƒ…å†µï¼ˆæœˆï¼‰</h3>
                    <div class="flex items-center">
                        <span class="text-sm text-green-400 mr-2">åˆæ ¼ç‡: 99.97%</span>
                        <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-xs font-bold">
                            5948
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="processInspectionChart"></canvas>
                </div>
            </div>
        </main>
        
        <!-- åº•éƒ¨åŒºåŸŸå¸ƒå±€ -->
        <div class="mt-4 flex gap-4">
            <!-- å·¦ä¾§ï¼šå½“å‰æ­£åœ¨è¿›è¡Œçš„å·¥å• (50% å®½åº¦) -->
            <div class="flex-1">
                <div class="p-3 bg-blue-500/20 border border-blue-500/50 rounded-lg h-full">
                    <h4 class="text-sm font-semibold text-blue-300 mb-2 flex items-center">
                        <svg width="16" height="16" fill="currentColor" class="mr-2" viewBox="0 0 24 24">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        å½“å‰æ­£åœ¨è¿›è¡Œçš„å·¥å•
                    </h4>
                    <div class="overflow-hidden h-64">
                        <div id="work-orders-scroll" class="space-y-2 animate-scroll-slow">
                            <div class="bg-blue-600/30 p-2 rounded border border-blue-500/50">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="font-semibold text-blue-200 text-sm">WO-20240720-001</div>
                                        <div class="text-xs text-blue-300">å‘åŠ¨æœºç¼¸ä½“æ£€éªŒ</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-blue-400 text-sm">è¿›è¡Œä¸­</div>
                                        <div class="text-xs text-blue-300">09:30å¼€å§‹</div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-blue-600/30 p-2 rounded border border-blue-500/50">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="font-semibold text-blue-200 text-sm">WO-20240720-002</div>
                                        <div class="text-xs text-blue-300">ä¼ åŠ¨è½´è´¨é‡æ£€æµ‹</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-blue-400 text-sm">è¿›è¡Œä¸­</div>
                                        <div class="text-xs text-blue-300">10:15å¼€å§‹</div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-blue-600/30 p-2 rounded border border-blue-500/50">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="font-semibold text-blue-200 text-sm">WO-20240720-003</div>
                                        <div class="text-xs text-blue-300">åˆ¶åŠ¨ç›˜æ£€éªŒ</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-blue-400 text-sm">è¿›è¡Œä¸­</div>
                                        <div class="text-xs text-blue-300">11:00å¼€å§‹</div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-blue-600/30 p-2 rounded border border-blue-500/50">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="font-semibold text-blue-200 text-sm">WO-20240720-004</div>
                                        <div class="text-xs text-blue-300">æ‚¬æŒ‚ç³»ç»Ÿæ£€æµ‹</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-blue-400 text-sm">è¿›è¡Œä¸­</div>
                                        <div class="text-xs text-blue-300">11:45å¼€å§‹</div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-blue-600/30 p-2 rounded border border-blue-500/50">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="font-semibold text-blue-200 text-sm">WO-20240720-005</div>
                                        <div class="text-xs text-blue-300">è½®èƒè´¨é‡æ£€éªŒ</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-blue-400 text-sm">è¿›è¡Œä¸­</div>
                                        <div class="text-xs text-blue-300">12:30å¼€å§‹</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šè¶…æ—¶é¢„è­¦è¯¦æƒ… (50% å®½åº¦) -->
            <div id="overdue-details" class="flex-1 space-y-4">
                <!-- é¢„è­¦é¡¹ç›® (Warning - Yellow) -->
                <div id="warning-section" class="p-3 bg-yellow-500/20 border border-yellow-500/50 rounded-lg">
                    <h4 class="text-sm font-semibold text-yellow-300 mb-2 flex items-center">
                        <svg width="16" height="16" fill="currentColor" class="mr-2" viewBox="0 0 24 24">
                            <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                        </svg>
                        é¢„è­¦é¡¹ç›® (1-4å°æ—¶è¶…æ—¶)
                    </h4>
                    <div class="space-y-2" id="warning-items">
                        <div class="bg-yellow-600/30 p-2 rounded border border-yellow-500/50">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="font-semibold text-yellow-200 text-sm">MAT-20240720-002</div>
                                    <div class="text-xs text-yellow-300">é“åˆé‡‘é…ä»¶</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-yellow-400 font-bold text-sm">è¶…æ—¶ 2å°æ—¶</div>
                                    <div class="text-xs text-yellow-300">16:30</div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-yellow-600/30 p-2 rounded border border-yellow-500/50">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="font-semibold text-yellow-200 text-sm">MAT-20240720-003</div>
                                    <div class="text-xs text-yellow-300">å¡‘æ–™ä»¶</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-yellow-400 font-bold text-sm">è¶…æ—¶ 3å°æ—¶</div>
                                    <div class="text-xs text-yellow-300">15:45</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ä¸¥é‡è¶…æ—¶é¡¹ç›® (Alert - Red) -->
                <div id="alert-section" class="p-3 bg-red-500/20 border border-red-500/50 rounded-lg">
                    <h4 class="text-sm font-semibold text-red-300 mb-2 flex items-center">
                        <svg width="16" height="16" fill="currentColor" class="mr-2" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        ä¸¥é‡è¶…æ—¶é¡¹ç›® (>4å°æ—¶)
                    </h4>
                    <div class="space-y-2" id="alert-items">
                        <div class="bg-red-600/30 p-2 rounded border border-red-500/50">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="font-semibold text-red-200 text-sm">MAT-20240720-001</div>
                                    <div class="text-xs text-red-300">é’¢ææ¿æ</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-red-400 font-bold text-sm">è¶…æ—¶ 6å°æ—¶</div>
                                    <div class="text-xs text-red-300">14:30</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Update current time
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('current-time').textContent = timeString;
        }
        updateTime();
        setInterval(updateTime, 1000);

        // Chart.js default options
        const defaultChartOptions = {
            maintainAspectRatio: false,
            responsive: true,
            plugins: {
                legend: {
                    labels: { 
                        color: '#ffffff',
                        font: { size: 12 }
                    }
                }
            }
        };

        // Mock data for charts - Material quality with defects
        const materialQualityData = {
            labels: ['åˆæ ¼', 'ä¸åˆæ ¼'],
            datasets: [{
                data: [132, 3], // 132 good, 3 defective
                backgroundColor: ['#4ade80', '#ef4444'], // Green for good, Red for defective
                borderColor: 'rgba(255,255,255,0.3)',
                borderWidth: 2
            }]
        };

        // Mock defect reasons data
        const defectReasons = [
            { reason: 'å°ºå¯¸åå·®', percentage: 45, count: 9 },
            { reason: 'è¡¨é¢ç¼ºé™·', percentage: 28, count: 6 },
            { reason: 'æè´¨ä¸ç¬¦', percentage: 15, count: 3 },
            { reason: 'åŒ…è£…æŸå', percentage: 8, count: 2 },
            { reason: 'æ ‡è¯†é”™è¯¯', percentage: 4, count: 1 }
        ];

        const monthlyDays = Array.from({length: 20}, (_, i) => `7/${i + 1}`);
        
        // Material trend data (pass rate over time)
        const materialTrendData = {
            labels: monthlyDays,
            datasets: [{
                label: 'åŸææ–™åˆæ ¼ç‡',
                data: Array.from({length: 20}, () => Math.floor(Math.random() * 5) + 95), // 95-100% range
                backgroundColor: 'rgba(74, 222, 128, 0.2)',
                borderColor: '#4ade80',
                borderWidth: 2,
                fill: true,
                tension: 0.4
            }]
        };

        // Process trend data (pass rate over time)
        const processTrendData = {
            labels: monthlyDays,
            datasets: [{
                label: 'è¿‡ç¨‹æ£€éªŒåˆæ ¼ç‡',
                data: Array.from({length: 20}, () => Math.floor(Math.random() * 3) + 98), // 98-100% range
                backgroundColor: 'rgba(59, 130, 246, 0.2)',
                borderColor: '#3b82f6',
                borderWidth: 2,
                fill: true,
                tension: 0.4
            }]
        };
        
        const materialInspectionData = {
            labels: monthlyDays,
            datasets: [{
                label: 'å·²æ£€é¡¹ç›®',
                data: Array.from({length: 20}, () => Math.floor(Math.random() * 15) + 5),
                backgroundColor: 'rgba(74, 222, 128, 0.6)',
                borderColor: '#4ade80',
                borderWidth: 1
            }]
        };

        const processInspectionData = {
            labels: monthlyDays,
            datasets: [
                {
                    label: 'å·²æ£€é¡¹',
                    data: Array.from({length: 20}, () => Math.floor(Math.random() * 200) + 250),
                    backgroundColor: 'rgba(59, 130, 246, 0.6)',
                    borderColor: '#3b82f6'
                },
                {
                    label: 'è¿›è¡Œä¸­',
                    data: Array.from({length: 20}, () => Math.floor(Math.random() * 20) + 5),
                    backgroundColor: 'rgba(251, 191, 36, 0.6)',
                    borderColor: '#fbbf24'
                },
                {
                    label: 'å·²é€¾æœŸ',
                    data: Array.from({length: 20}, () => Math.floor(Math.random() * 5)),
                    backgroundColor: 'rgba(239, 68, 68, 0.6)',
                    borderColor: '#ef4444'
                }
            ]
        };

        // Function to update defect reasons display
        function updateDefectReasons() {
            const defectContainer = document.getElementById('defect-reasons');
            defectContainer.innerHTML = '';
            
            defectReasons.forEach((defect, index) => {
                const borderColors = ['border-red-500', 'border-red-400', 'border-red-300', 'border-red-200', 'border-red-100'];
                const bgOpacities = [0.2, 0.15, 0.10, 0.08, 0.05];
                
                const item = document.createElement('div');
                item.className = `flex justify-between items-center py-1 px-2 rounded border-l-4 ${borderColors[index]}`;
                item.style.backgroundColor = `rgba(239, 68, 68, ${bgOpacities[index]})`;
                item.innerHTML = `
                    <span class="text-red-200">${defect.reason}</span>
                    <span class="text-red-400 font-bold">${defect.percentage}%</span>
                `;
                defectContainer.appendChild(item);
            });
        }

        // Initialize charts
        // Material Quality Doughnut Chart
        const materialQualityCtx = document.getElementById('materialQualityChart').getContext('2d');
        const materialQualityChart = new Chart(materialQualityCtx, {
            type: 'doughnut',
            data: materialQualityData,
            options: {
                ...defaultChartOptions,
                cutout: '70%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { 
                            color: '#ffffff',
                            font: { size: 10 },
                            padding: 10
                        }
                    }
                },
                onClick: (event, elements) => {
                    if (elements.length > 0) {
                        const clickedIndex = elements[0].index;
                        if (clickedIndex === 1) { // Clicked on defective (red) section
                            // Highlight the defect reasons
                            document.getElementById('defect-reasons').style.border = '2px solid #ef4444';
                            setTimeout(() => {
                                document.getElementById('defect-reasons').style.border = 'none';
                            }, 2000);
                        }
                    }
                }
            }
        });

        // Initialize defect reasons display
        updateDefectReasons();

        // Material Trend Line Chart
        const materialTrendCtx = document.getElementById('materialTrendChart').getContext('2d');
        new Chart(materialTrendCtx, {
            type: 'line',
            data: materialTrendData,
            options: {
                ...defaultChartOptions,
                scales: {
                    x: {
                        ticks: { 
                            color: '#ffffff',
                            font: { size: 10 },
                            maxRotation: 45
                        },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    },
                    y: {
                        beginAtZero: false,
                        min: 90,
                        max: 100,
                        ticks: { 
                            color: '#ffffff',
                            font: { size: 10 },
                            callback: function(value) {
                                return value + '%';
                            }
                        },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });

        // Process Trend Line Chart
        const processTrendCtx = document.getElementById('processTrendChart').getContext('2d');
        new Chart(processTrendCtx, {
            type: 'line',
            data: processTrendData,
            options: {
                ...defaultChartOptions,
                scales: {
                    x: {
                        ticks: { 
                            color: '#ffffff',
                            font: { size: 10 },
                            maxRotation: 45
                        },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    },
                    y: {
                        beginAtZero: false,
                        min: 95,
                        max: 100,
                        ticks: { 
                            color: '#ffffff',
                            font: { size: 10 },
                            callback: function(value) {
                                return value + '%';
                            }
                        },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });

        // Material Inspection Bar Chart
        const materialInspectionCtx = document.getElementById('materialInspectionChart').getContext('2d');
        new Chart(materialInspectionCtx, {
            type: 'bar',
            data: materialInspectionData,
            options: {
                ...defaultChartOptions,
                scales: {
                    x: {
                        ticks: { 
                            color: '#ffffff',
                            font: { size: 10 },
                            maxRotation: 45
                        },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: { 
                            color: '#ffffff',
                            font: { size: 10 }
                        },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });

        // Process Inspection Bar Chart
        const processInspectionCtx = document.getElementById('processInspectionChart').getContext('2d');
        new Chart(processInspectionCtx, {
            type: 'bar',
            data: processInspectionData,
            options: {
                ...defaultChartOptions,
                scales: {
                    x: {
                        ticks: { 
                            color: '#ffffff',
                            font: { size: 10 },
                            maxRotation: 45
                        },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    },
                    y: {
                        beginAtZero: true,
                        stacked: true,
                        ticks: { 
                            color: '#ffffff',
                            font: { size: 10 }
                        },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                        labels: { 
                            color: '#ffffff',
                            font: { size: 10 },
                            padding: 15
                        }
                    }
                }
            }
        });

        // Mock overdue data with warning levels
        const overdueItems = [
            {
                batchNo: 'MAT-20240720-001',
                material: 'é’¢ææ¿æ',
                supplier: 'æ±Ÿè‹é’¢é“æœ‰é™å…¬å¸',
                overdueHours: 6,
                expectedTime: '14:30',
                level: 'alert' // >4 hours = alert (red)
            },
            {
                batchNo: 'MAT-20240720-002',
                material: 'é“åˆé‡‘é…ä»¶',
                supplier: 'ä¸Šæµ·é‡‘å±åˆ¶å“å‚',
                overdueHours: 2,
                expectedTime: '16:30',
                level: 'warning' // 1-4 hours = warning (yellow)
            },
            {
                batchNo: 'MAT-20240720-003',
                material: 'å¡‘æ–™ä»¶',
                supplier: 'å¸¸å·å¡‘ä¸šå…¬å¸',
                overdueHours: 3,
                expectedTime: '15:45',
                level: 'warning' // 1-4 hours = warning (yellow)
            }
        ];

        // Update two-level warning system
        function updateOverdueWarnings() {
            // Simulate dynamic changes
            const currentOverdue = overdueItems.filter(item => Math.random() > 0.2);
            
            // Categorize by level
            const warnings = currentOverdue.filter(item => item.level === 'warning');
            const alerts = currentOverdue.filter(item => item.level === 'alert');
            
            const warningCount = warnings.length;
            const alertCount = alerts.length;
            const totalOverdue = warningCount + alertCount;
            
            // Update header notifications
            const warningElement = document.getElementById('overdue-warning');
            const alertElement = document.getElementById('overdue-alert');
            
            // Show/hide warning (yellow)
            if (warningCount > 0) {
                warningElement.textContent = `âš ï¸ ${warningCount}é¡¹é¢„è­¦ (1-4å°æ—¶)`;
                warningElement.classList.remove('hidden');
            } else {
                warningElement.classList.add('hidden');
            }
            
            // Show/hide alert (red)
            if (alertCount > 0) {
                alertElement.textContent = `ğŸš¨ ${alertCount}é¡¹ä¸¥é‡è¶…æ—¶ (>4å°æ—¶)`;
                alertElement.classList.remove('hidden');
            } else {
                alertElement.classList.add('hidden');
            }
            
            // Update timeliness rate
            const timelinessRate = ((98 - totalOverdue) / 98 * 100).toFixed(1);
            document.querySelector('.text-green-400').textContent = `${timelinessRate}%`;
            
            // Update status counts
            document.getElementById('on-time-count').textContent = 98 - totalOverdue;
            document.getElementById('warning-count').textContent = warningCount;
            document.getElementById('alert-count').textContent = alertCount;
        }

        // Simulate real-time updates
        setInterval(() => {
            // Update today's inspection count
            const todayCount = Math.floor(Math.random() * 10) + 95;
            document.querySelector('.metric-value.text-blue-300').textContent = todayCount;
            
            // Update overdue warnings
            updateOverdueWarnings();
            
            // Occasionally update material quality data
            if (Math.random() > 0.7) {
                const goodCount = Math.floor(Math.random() * 5) + 130;
                const defectCount = Math.floor(Math.random() * 3) + 2;
                const total = goodCount + defectCount;
                const passRate = ((goodCount / total) * 100).toFixed(1);
                
                // Update chart data
                materialQualityChart.data.datasets[0].data = [goodCount, defectCount];
                materialQualityChart.update();
                
                // Update pass rate display
                document.getElementById('material-pass-rate').textContent = `${passRate}%`;
                
                // Update batch count in center
                document.querySelector('.text-xl.font-bold.text-white').textContent = goodCount;
                
                // Update defect reasons with random variations
                defectReasons.forEach(defect => {
                    defect.percentage += Math.floor(Math.random() * 6) - 3; // Â±3%
                    defect.percentage = Math.max(1, Math.min(50, defect.percentage)); // Keep in range
                });
                updateDefectReasons();
            }
        }, 10000);

        // Mock work orders data
        const workOrders = [
            { id: 'WO-20240720-001', task: 'å‘åŠ¨æœºç¼¸ä½“æ£€éªŒ', startTime: '09:30' },
            { id: 'WO-20240720-002', task: 'ä¼ åŠ¨è½´è´¨é‡æ£€æµ‹', startTime: '10:15' },
            { id: 'WO-20240720-003', task: 'åˆ¶åŠ¨ç›˜æ£€éªŒ', startTime: '11:00' },
            { id: 'WO-20240720-004', task: 'æ‚¬æŒ‚ç³»ç»Ÿæ£€æµ‹', startTime: '11:45' },
            { id: 'WO-20240720-005', task: 'è½®èƒè´¨é‡æ£€éªŒ', startTime: '12:30' },
            { id: 'WO-20240720-006', task: 'å˜é€Ÿç®±æ£€æµ‹', startTime: '13:15' },
            { id: 'WO-20240720-007', task: 'ç”µæ± ç»„æ£€éªŒ', startTime: '14:00' },
            { id: 'WO-20240720-008', task: 'æ’æ°”ç³»ç»Ÿæ£€æµ‹', startTime: '14:45' }
        ];

        // Function to update work orders display
        function updateWorkOrders() {
            const scrollContainer = document.getElementById('work-orders-scroll');
            scrollContainer.innerHTML = '';
            
            // Duplicate the items for continuous scrolling
            const allOrders = [...workOrders, ...workOrders];
            
            allOrders.forEach(order => {
                const item = document.createElement('div');
                item.className = 'bg-blue-600/30 p-2 rounded border border-blue-500/50';
                item.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-semibold text-blue-200 text-sm">${order.id}</div>
                            <div class="text-xs text-blue-300">${order.task}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-blue-400 text-sm">è¿›è¡Œä¸­</div>
                            <div class="text-xs text-blue-300">${order.startTime}å¼€å§‹</div>
                        </div>
                    </div>
                `;
                scrollContainer.appendChild(item);
            });
        }

        // Initialize work orders
        updateWorkOrders();

        // Initial overdue warning update
        updateOverdueWarnings();
    </script>
</body>
</html>